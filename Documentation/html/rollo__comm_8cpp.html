<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Rollo - Localization of a humanoid robot: /home/emeres/.hdd/Documents/Studia/Universit√† degli studi di Genova/DIBRIS/Tutti i corsi/86805 - SOFTWARE ARCHITECTURES FOR ROBOTICS/AS01/rollo/src/rollo_comm.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Rollo - Localization of a humanoid robot
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Project deals with the aspect of localization of a humanoid robot using the extended Kalman filter and ROS as working environment with help of motion capture</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_3675c8be3ce0cb7ae2ab347da3d8ce0e.html">rollo</a></li><li class="navelem"><a class="el" href="dir_d8c8f1b0e058b4933110fc5d14c32e21.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">rollo_comm.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Communication between ROS and Rollo.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;ros/ros.h&quot;</code><br />
<code>#include &lt;sstream&gt;</code><br />
<code>#include &lt;iostream&gt;</code><br />
<code>#include &quot;string.h&quot;</code><br />
<code>#include &quot;<a class="el" href="rollo_8hpp_source.html">rollo.hpp</a>&quot;</code><br />
<code>#include &quot;geometry_msgs/Twist.h&quot;</code><br />
<code>#include &quot;rollo/WheelSpeed.h&quot;</code><br />
<code>#include &quot;udp.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae08ba04eb54f1f3f17f135034452e92c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#ae08ba04eb54f1f3f17f135034452e92c">decodeVelocities</a> (double x, double z, char *<a class="el" href="rollo__comm_8cpp.html#a6a1049334981cb492eb11e06c60e4fb5">Message</a>, int &amp;VelocityL, int &amp;<a class="el" href="rollo__comm_8cpp.html#aed09ee61ffab38077b4e5852bfcb16e6">VelocityR</a>)</td></tr>
<tr class="memdesc:ae08ba04eb54f1f3f17f135034452e92c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Range of speed of the Rollo.  <a href="#ae08ba04eb54f1f3f17f135034452e92c">More...</a><br /></td></tr>
<tr class="separator:ae08ba04eb54f1f3f17f135034452e92c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed7376fac78c6c864f69338bd09e3133"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#aed7376fac78c6c864f69338bd09e3133">subscriberCallback</a> (const geometry_msgs::Twist::ConstPtr &amp;msg)</td></tr>
<tr class="memdesc:aed7376fac78c6c864f69338bd09e3133"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subscriber callback.  <a href="#aed7376fac78c6c864f69338bd09e3133">More...</a><br /></td></tr>
<tr class="separator:aed7376fac78c6c864f69338bd09e3133"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46c0664a525ae3467335e8ba78396d07"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a46c0664a525ae3467335e8ba78396d07">udpSend</a> (char <a class="el" href="rollo__comm_8cpp.html#ac03ec605186c0c6d17c4beaab73d615c">ip</a>[16], int <a class="el" href="rollo__comm_8cpp.html#a63c89c04d1feae07ca35558055155ffb">port</a>, char *<a class="el" href="rollo__comm_8cpp.html#a6a1049334981cb492eb11e06c60e4fb5">Message</a>)</td></tr>
<tr class="memdesc:a46c0664a525ae3467335e8ba78396d07"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send UDP packets.  <a href="#a46c0664a525ae3467335e8ba78396d07">More...</a><br /></td></tr>
<tr class="separator:a46c0664a525ae3467335e8ba78396d07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="memdesc:a3c04138a5bfe5d72780bb7e82a18e627"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main function.  <a href="#a3c04138a5bfe5d72780bb7e82a18e627">More...</a><br /></td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ac9c755d41ea44e27fdce963bd3ac8d50"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#ac9c755d41ea44e27fdce963bd3ac8d50">NodeName</a> [20] = C3 CM <a class="el" href="rollo_8hpp.html#a876ce77f3c672c7162658151e648389e">CR</a></td></tr>
<tr class="memdesc:ac9c755d41ea44e27fdce963bd3ac8d50"><td class="mdescLeft">&#160;</td><td class="mdescRight">Global variables updated in the <code>SubscriberCallback</code> function, processed and used to send commands to the specified <code>IP</code> adress at the <code>UDP</code> port.  <a href="#ac9c755d41ea44e27fdce963bd3ac8d50">More...</a><br /></td></tr>
<tr class="separator:ac9c755d41ea44e27fdce963bd3ac8d50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22cba6fb9ef3df1b681601efb5ccbc2c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a22cba6fb9ef3df1b681601efb5ccbc2c"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a22cba6fb9ef3df1b681601efb5ccbc2c">TopicWheelSpeed</a> [64] = <a class="el" href="rollo_8hpp.html#ae7e7dd1f59a7dec839d19825d873e077">TOPIC_COMM_WS</a></td></tr>
<tr class="memdesc:a22cba6fb9ef3df1b681601efb5ccbc2c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Topic for wheel speed containing the actual speed of wheel, preferably extracted from encoders or if not available by using a lookup table. <br /></td></tr>
<tr class="separator:a22cba6fb9ef3df1b681601efb5ccbc2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88720e7d89de956a13c9cf8eb60aa489"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a88720e7d89de956a13c9cf8eb60aa489"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a88720e7d89de956a13c9cf8eb60aa489">TopicCmdVel</a> [64] = TOPIC_CTRL_CMD_VEL</td></tr>
<tr class="memdesc:a88720e7d89de956a13c9cf8eb60aa489"><td class="mdescLeft">&#160;</td><td class="mdescRight">Topic for commands generated by control node expressed in linear and angular velocity. <br /></td></tr>
<tr class="separator:a88720e7d89de956a13c9cf8eb60aa489"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac03ec605186c0c6d17c4beaab73d615c"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#ac03ec605186c0c6d17c4beaab73d615c">ip</a> [16] = &quot;192.168.0.120&quot;</td></tr>
<tr class="memdesc:ac03ec605186c0c6d17c4beaab73d615c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Rollo default IP: 192.168.0.120.  <a href="#ac03ec605186c0c6d17c4beaab73d615c">More...</a><br /></td></tr>
<tr class="separator:ac03ec605186c0c6d17c4beaab73d615c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63c89c04d1feae07ca35558055155ffb"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a63c89c04d1feae07ca35558055155ffb"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a63c89c04d1feae07ca35558055155ffb">port</a> = 900</td></tr>
<tr class="memdesc:a63c89c04d1feae07ca35558055155ffb"><td class="mdescLeft">&#160;</td><td class="mdescRight">UDP port. <br /></td></tr>
<tr class="separator:a63c89c04d1feae07ca35558055155ffb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2687e4b3cb5da7dbd00e565343f66c6c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2687e4b3cb5da7dbd00e565343f66c6c"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a2687e4b3cb5da7dbd00e565343f66c6c">tol</a> = 0.01</td></tr>
<tr class="memdesc:a2687e4b3cb5da7dbd00e565343f66c6c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tolerance for determining linear and angular velocities from the control node. <br /></td></tr>
<tr class="separator:a2687e4b3cb5da7dbd00e565343f66c6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10a75d5c257fce0d0e521a8f59360759"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a10a75d5c257fce0d0e521a8f59360759"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>v_l</b></td></tr>
<tr class="separator:a10a75d5c257fce0d0e521a8f59360759"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fb358b515e22053bb9d08df267302ff"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7fb358b515e22053bb9d08df267302ff"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a7fb358b515e22053bb9d08df267302ff">v_r</a></td></tr>
<tr class="memdesc:a7fb358b515e22053bb9d08df267302ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Velocities for both wheels. <br /></td></tr>
<tr class="separator:a7fb358b515e22053bb9d08df267302ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a047da550749cbfda4481133dd1ea99af"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a047da550749cbfda4481133dd1ea99af"></a>
unsigned const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a047da550749cbfda4481133dd1ea99af">nb</a> = 3</td></tr>
<tr class="memdesc:a047da550749cbfda4481133dd1ea99af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of bytes in the message. <br /></td></tr>
<tr class="separator:a047da550749cbfda4481133dd1ea99af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a1049334981cb492eb11e06c60e4fb5"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6a1049334981cb492eb11e06c60e4fb5"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a6a1049334981cb492eb11e06c60e4fb5">Message</a> [<a class="el" href="rollo__comm_8cpp.html#a047da550749cbfda4481133dd1ea99af">nb</a>] = {0x7b, 0x50, 0x10}</td></tr>
<tr class="memdesc:a6a1049334981cb492eb11e06c60e4fb5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Message combined, complete stop default. <br /></td></tr>
<tr class="separator:a6a1049334981cb492eb11e06c60e4fb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2327c485b9ca6502676def4a22819b21"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a2327c485b9ca6502676def4a22819b21">MessageEmergencyStop</a> [<a class="el" href="rollo__comm_8cpp.html#a047da550749cbfda4481133dd1ea99af">nb</a>] = {0x7b, 0x50, 0x10}</td></tr>
<tr class="memdesc:a2327c485b9ca6502676def4a22819b21"><td class="mdescLeft">&#160;</td><td class="mdescRight">Emergency variables.  <a href="#a2327c485b9ca6502676def4a22819b21">More...</a><br /></td></tr>
<tr class="separator:a2327c485b9ca6502676def4a22819b21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a8165a59cdf3528f3915ad5cbc9b20a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1a8165a59cdf3528f3915ad5cbc9b20a"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a1a8165a59cdf3528f3915ad5cbc9b20a">lastMessageTime</a> = 0</td></tr>
<tr class="memdesc:a1a8165a59cdf3528f3915ad5cbc9b20a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Last message from control node. <br /></td></tr>
<tr class="separator:a1a8165a59cdf3528f3915ad5cbc9b20a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a272038ad264893a568c808f13d818b17"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a272038ad264893a568c808f13d818b17"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a272038ad264893a568c808f13d818b17">currentTime</a> = 0</td></tr>
<tr class="memdesc:a272038ad264893a568c808f13d818b17"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current time holder. <br /></td></tr>
<tr class="separator:a272038ad264893a568c808f13d818b17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d2d7f968a14b48ce6d224fa5a4582b4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0d2d7f968a14b48ce6d224fa5a4582b4"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a0d2d7f968a14b48ce6d224fa5a4582b4">EmergencyTime</a> = 30</td></tr>
<tr class="memdesc:a0d2d7f968a14b48ce6d224fa5a4582b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Emergency time [s]. <br /></td></tr>
<tr class="separator:a0d2d7f968a14b48ce6d224fa5a4582b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2063db22c564ad7bb00b262c6413295f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2063db22c564ad7bb00b262c6413295f"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a2063db22c564ad7bb00b262c6413295f">Mode</a> [2]</td></tr>
<tr class="memdesc:a2063db22c564ad7bb00b262c6413295f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Message mode description. <br /></td></tr>
<tr class="separator:a2063db22c564ad7bb00b262c6413295f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84e1322ee9513953d58e396cb32b125e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a84e1322ee9513953d58e396cb32b125e"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>VelocityL</b></td></tr>
<tr class="separator:a84e1322ee9513953d58e396cb32b125e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed09ee61ffab38077b4e5852bfcb16e6"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aed09ee61ffab38077b4e5852bfcb16e6"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#aed09ee61ffab38077b4e5852bfcb16e6">VelocityR</a></td></tr>
<tr class="memdesc:aed09ee61ffab38077b4e5852bfcb16e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Message velocities description. <br /></td></tr>
<tr class="separator:aed09ee61ffab38077b4e5852bfcb16e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1cdd4055b04d9f7ec3e9b5833728768"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae1cdd4055b04d9f7ec3e9b5833728768"></a>
unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#ae1cdd4055b04d9f7ec3e9b5833728768">loopcounter</a> = 1</td></tr>
<tr class="memdesc:ae1cdd4055b04d9f7ec3e9b5833728768"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loop counter for debugging purpose. <br /></td></tr>
<tr class="separator:ae1cdd4055b04d9f7ec3e9b5833728768"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4dd7cdb763ac065ea299d60fb7a5112c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4dd7cdb763ac065ea299d60fb7a5112c"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a4dd7cdb763ac065ea299d60fb7a5112c">RolloMax</a> = ROLLO_SPEED_MAX</td></tr>
<tr class="memdesc:a4dd7cdb763ac065ea299d60fb7a5112c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum speed of the Rollo. <br /></td></tr>
<tr class="separator:a4dd7cdb763ac065ea299d60fb7a5112c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a732f8fd84c939ac35086428409dc65ff"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a732f8fd84c939ac35086428409dc65ff"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a732f8fd84c939ac35086428409dc65ff">RolloMin</a> = ROLLO_SPEED_MIN</td></tr>
<tr class="memdesc:a732f8fd84c939ac35086428409dc65ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Minimum speed of the Rollo. <br /></td></tr>
<tr class="separator:a732f8fd84c939ac35086428409dc65ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42b5cf6e37e4d7d69b9e07e460ad50df"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a42b5cf6e37e4d7d69b9e07e460ad50df"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><b>RolloRange</b> = <a class="el" href="rollo__comm_8cpp.html#a4dd7cdb763ac065ea299d60fb7a5112c">RolloMax</a> - <a class="el" href="rollo__comm_8cpp.html#a732f8fd84c939ac35086428409dc65ff">RolloMin</a></td></tr>
<tr class="separator:a42b5cf6e37e4d7d69b9e07e460ad50df"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Communication between ROS and Rollo. </p>
<dl class="section author"><dt>Author</dt><dd>Rabbia Asghar, Ernest Skrzypczyk </dd></dl>
<dl class="section date"><dt>Date</dt><dd>18/2/16 Provides basic communication structure between ROS holding nodes used for localization and Rollo. Main aspects include:<ul>
<li>decoding linear and angular velocities provided by control node</li>
<li>translate and send message to Rollo</li>
<li>publish decoded velocities</li>
<li>square test or n-th order</li>
<li>emergency procedure</li>
</ul>
</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a href="https://github.com/em-er-es/rollo/">https://github.com/em-er-es/rollo/</a> </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ae08ba04eb54f1f3f17f135034452e92c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int decodeVelocities </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>VelocityL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>VelocityR</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Range of speed of the Rollo. </p>
<p>Decode linear and angular velocities</p>
<p>Velocities are decoded and stored as partial bytes of the UDP packet Parameters declared: <code>x</code>, <code>z</code>, <code>&amp;Message</code>, <code>VelocityL</code>, <code>VelocityR</code>. </p><dl class="section return"><dt>Returns</dt><dd>0 </dd></dl>
<p>Determine corresponding operation mode based on velocities</p>
<p>Complete stop</p>
<p>Right rotation</p>
<p>Left rotation</p>
<p>Lowest speeds for previous modes</p>
<p>Determine speeds based on the position of the "dial" z<br />
|-a-|- - -*-b- - - - -|<br />
-1 z 0 1</p>
<p>Temporary velocity holder</p>
<p>Eliminate problems with dividing through zero by adding a small number to variables</p>
<p>Calculate velocities according to relation expressed in linear and angular velocities ratio</p>
<p>Translate velocities for Rollo Left velocity - Second byte</p>
<p>Right velocity - Third byte</p>
<p>Temporary fix for errartic behaviour of Rollo</p>
<p>Determine forward or backward movement based on linear velocity </p>

</div>
</div>
<a class="anchor" id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main function. </p>
<p>Depending on specified parameters processes data from control node and Rollo and transmits them to appropriate targets or runs a square test of n-th order</p>
<dl class="section return"><dt>Returns</dt><dd>0 </dd></dl>
<p>Initialize node</p>
<p>Initialize nodehandle</p>
<p>Initialie subscriber and define topic and message queue size</p>
<p>Publish velocities as [rpm]</p>
<p>Initialize node arguments using command line</p>
<p>Initialize node parameters from launch file or command line. Use a private node handle so that multiple instances of the node can be run simultaneously while using different parameters.</p>
<p>Node main parameters</p>
<p>Square test parameters Default values</p>
<p>Node frequency rate [Hz]</p>
<p>Initialize subscriber message type</p>
<p>Initialize publisher message type</p>
<p>Initialize variables for computing linear and angular velocity of the robot</p>
<p>Client initialization</p>
<p>Square test</p><ul>
<li>Alternatively this square test could be in control node, however communication node is "closer" to Rollo</li>
</ul>
<p>Print information on current run</p>
<p>Compose turn command</p>
<p>Check square run variable and determine turning direction</p>
<p>For multiple runs the robot would go back and forth providing more reliable data on the actual error In ideal case even a high order square run would result in the robot being at the initial position with initial orientation</p>
<p>Compose forward command</p>
<p>Set initial time</p>
<p>Bytes sent, useful for debugging</p>
<p>Main square loop</p>
<p>Moving forward</p>
<p>Send command 3 times</p>
<p>Wait for the specified time to move forward</p>
<p>Turning</p>
<p>Send command 3 times</p>
<p>Wait for the specified time to turn</p>
<p>Main square loop end</p>
<p>Update run finish time</p>
<p>Print duration time</p>
<p>Update square run counter and check for exit condition</p>
<p>Main loop</p>
<p>Send control command to Rollo</p>
<p>Compose message</p>
<p>Publish message</p>
<p>ROS spinOnce</p>
<p>Sleep before running loop again</p>
<p>Increase loopcounter</p>
<p>Main loop end </p>

</div>
</div>
<a class="anchor" id="aed7376fac78c6c864f69338bd09e3133"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void subscriberCallback </td>
          <td>(</td>
          <td class="paramtype">const geometry_msgs::Twist::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subscriber callback. </p>
<p>Reads newest velocities from control node and translates them into UDP message Updates latest message time</p>
<dl class="section return"><dt>Returns</dt><dd>0 </dd></dl>
<p>Update the UDP message</p>
<p>Update last message time </p>

</div>
</div>
<a class="anchor" id="a46c0664a525ae3467335e8ba78396d07"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int udpSend </td>
          <td>(</td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>ip</em>[16], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Message</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send UDP packets. </p>
<p>Send provided message using included UDP library command <code><a class="el" href="classudp__client__server_1_1udp__client.html#ac296d1fb6a6006bec5f8f14a81367d0a" title="Send a message through this UDP client. ">udp_client_server::udp_client.send()</a></code> </p>
<p>Parameters declared by reference: <code>&amp;ip</code>, <code>&amp;port</code>, <code>&amp;message</code>.</p>
<dl class="section return"><dt>Returns</dt><dd><code>bs</code> Bytes sent </dd></dl>
<p>Client initialization</p>
<p>Send UDP message</p>
<p>Check if number of bytes sent is equal to bytes of composed message</p>
<p>Error handling</p>
<p>Return bytes sent or error code </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="ac03ec605186c0c6d17c4beaab73d615c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char ip[16] = &quot;192.168.0.120&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Rollo default IP: 192.168.0.120. </p>
<p>Ip address statically assigned </p>

</div>
</div>
<a class="anchor" id="a2327c485b9ca6502676def4a22819b21"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char MessageEmergencyStop[<a class="el" href="rollo__comm_8cpp.html#a047da550749cbfda4481133dd1ea99af">nb</a>] = {0x7b, 0x50, 0x10}</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Emergency variables. </p>
<p>Emergency message - complete stop </p>

</div>
</div>
<a class="anchor" id="ac9c755d41ea44e27fdce963bd3ac8d50"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char NodeName[20] = C3 CM <a class="el" href="rollo_8hpp.html#a876ce77f3c672c7162658151e648389e">CR</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Global variables updated in the <code>SubscriberCallback</code> function, processed and used to send commands to the specified <code>IP</code> adress at the <code>UDP</code> port. </p>
<p>Node name using console codes </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
