<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Rollo - Localization of a humanoid robot: rollo_comm.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Rollo - Localization of a humanoid robot
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Project deals with the aspect of localization of a humanoid robot using the extended Kalman filter and ROS as working environment with help of motion capture</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">rollo_comm.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Communication between ROS and Rollo.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;ros/ros.h&quot;</code><br />
<code>#include &lt;sstream&gt;</code><br />
<code>#include &lt;iostream&gt;</code><br />
<code>#include &quot;string.h&quot;</code><br />
<code>#include &quot;<a class="el" href="rollo_8hpp_source.html">rollo.hpp</a>&quot;</code><br />
<code>#include &quot;geometry_msgs/Twist.h&quot;</code><br />
<code>#include &quot;rollo/WheelSpeed.h&quot;</code><br />
<code>#include &quot;<a class="el" href="udp_8h_source.html">udp.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for rollo_comm.cpp:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="rollo__comm_8cpp__incl.svg" width="100%" height="440"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae08ba04eb54f1f3f17f135034452e92c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#ae08ba04eb54f1f3f17f135034452e92c">decodeVelocities</a> (double <a class="el" href="rollo__preprocessor_8cpp.html#af88b946fb90d5f08b5fb740c70e98c10">x</a>, double z, char *<a class="el" href="rollo__comm_8cpp.html#a6a1049334981cb492eb11e06c60e4fb5">Message</a>, int &amp;<a class="el" href="rollo__comm_8cpp.html#a84e1322ee9513953d58e396cb32b125e">VelocityL</a>, int &amp;<a class="el" href="rollo__comm_8cpp.html#aed09ee61ffab38077b4e5852bfcb16e6">VelocityR</a>)</td></tr>
<tr class="memdesc:ae08ba04eb54f1f3f17f135034452e92c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decode linear and angular velocities.  <a href="#ae08ba04eb54f1f3f17f135034452e92c">More...</a><br /></td></tr>
<tr class="separator:ae08ba04eb54f1f3f17f135034452e92c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af756e338ef4741c56e65779cad33d03d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#af756e338ef4741c56e65779cad33d03d">EstimateFeedbackVelocities</a> (int <a class="el" href="rollo__comm_8cpp.html#a84e1322ee9513953d58e396cb32b125e">VelocityL</a>, int <a class="el" href="rollo__comm_8cpp.html#aed09ee61ffab38077b4e5852bfcb16e6">VelocityR</a>, double &amp;LeftVelocityEstimate, double &amp;RightVelocityEstimate)</td></tr>
<tr class="memdesc:af756e338ef4741c56e65779cad33d03d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Assign left and right wheel velocity estimates for a given velocity command.  <a href="#af756e338ef4741c56e65779cad33d03d">More...</a><br /></td></tr>
<tr class="separator:af756e338ef4741c56e65779cad33d03d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed7376fac78c6c864f69338bd09e3133"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#aed7376fac78c6c864f69338bd09e3133">subscriberCallback</a> (const geometry_msgs::Twist::ConstPtr &amp;msg)</td></tr>
<tr class="memdesc:aed7376fac78c6c864f69338bd09e3133"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subscriber callback from control node.  <a href="#aed7376fac78c6c864f69338bd09e3133">More...</a><br /></td></tr>
<tr class="separator:aed7376fac78c6c864f69338bd09e3133"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46c0664a525ae3467335e8ba78396d07"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a46c0664a525ae3467335e8ba78396d07">udpSend</a> (char <a class="el" href="rollo__comm_8cpp.html#ac03ec605186c0c6d17c4beaab73d615c">ip</a>[16], int <a class="el" href="rollo__comm_8cpp.html#a63c89c04d1feae07ca35558055155ffb">port</a>, char *<a class="el" href="rollo__comm_8cpp.html#a6a1049334981cb492eb11e06c60e4fb5">Message</a>)</td></tr>
<tr class="memdesc:a46c0664a525ae3467335e8ba78396d07"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send UDP packets.  <a href="#a46c0664a525ae3467335e8ba78396d07">More...</a><br /></td></tr>
<tr class="separator:a46c0664a525ae3467335e8ba78396d07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="memdesc:a3c04138a5bfe5d72780bb7e82a18e627"><td class="mdescLeft">&#160;</td><td class="mdescRight">Node main.  <a href="#a3c04138a5bfe5d72780bb7e82a18e627">More...</a><br /></td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ac9c755d41ea44e27fdce963bd3ac8d50"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac9c755d41ea44e27fdce963bd3ac8d50"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#ac9c755d41ea44e27fdce963bd3ac8d50">NodeName</a> [20] = <a class="el" href="rollo_8hpp.html#a58aba30d6a33889c81827a54620dd5d9">C3</a> <a class="el" href="rollo_8hpp.html#a86496c19c29b6c83337b300bfeef9c95">CM</a> <a class="el" href="rollo_8hpp.html#a876ce77f3c672c7162658151e648389e">CR</a></td></tr>
<tr class="memdesc:ac9c755d41ea44e27fdce963bd3ac8d50"><td class="mdescLeft">&#160;</td><td class="mdescRight">Node name using console codes. <br /></td></tr>
<tr class="separator:ac9c755d41ea44e27fdce963bd3ac8d50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22cba6fb9ef3df1b681601efb5ccbc2c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a22cba6fb9ef3df1b681601efb5ccbc2c"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a22cba6fb9ef3df1b681601efb5ccbc2c">TopicWheelSpeed</a> [64] = <a class="el" href="rollo_8hpp.html#ae7e7dd1f59a7dec839d19825d873e077">TOPIC_COMM_WS</a></td></tr>
<tr class="memdesc:a22cba6fb9ef3df1b681601efb5ccbc2c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Topic for wheel speed containing the actual speed of wheel, preferably extracted from encoders or if not available by using a lookup table. <br /></td></tr>
<tr class="separator:a22cba6fb9ef3df1b681601efb5ccbc2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88720e7d89de956a13c9cf8eb60aa489"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a88720e7d89de956a13c9cf8eb60aa489"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a88720e7d89de956a13c9cf8eb60aa489">TopicCmdVel</a> [64] = <a class="el" href="rollo_8hpp.html#abe651896fcc1d8c16f1fc53ff11e414e">TOPIC_CTRL_CMD_VEL</a></td></tr>
<tr class="memdesc:a88720e7d89de956a13c9cf8eb60aa489"><td class="mdescLeft">&#160;</td><td class="mdescRight">Topic for commands generated by control node expressed in linear and angular velocity. <br /></td></tr>
<tr class="separator:a88720e7d89de956a13c9cf8eb60aa489"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac03ec605186c0c6d17c4beaab73d615c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac03ec605186c0c6d17c4beaab73d615c"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#ac03ec605186c0c6d17c4beaab73d615c">ip</a> [16] = &quot;192.168.0.120&quot;</td></tr>
<tr class="memdesc:ac03ec605186c0c6d17c4beaab73d615c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Rollo ip address hardcoded. <br /></td></tr>
<tr class="separator:ac03ec605186c0c6d17c4beaab73d615c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63c89c04d1feae07ca35558055155ffb"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a63c89c04d1feae07ca35558055155ffb"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a63c89c04d1feae07ca35558055155ffb">port</a> = 900</td></tr>
<tr class="memdesc:a63c89c04d1feae07ca35558055155ffb"><td class="mdescLeft">&#160;</td><td class="mdescRight">UDP port. <br /></td></tr>
<tr class="separator:a63c89c04d1feae07ca35558055155ffb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2687e4b3cb5da7dbd00e565343f66c6c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2687e4b3cb5da7dbd00e565343f66c6c"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a2687e4b3cb5da7dbd00e565343f66c6c">tol</a> = 0.01</td></tr>
<tr class="memdesc:a2687e4b3cb5da7dbd00e565343f66c6c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tolerance for determining linear and angular velocities from the control node. <br /></td></tr>
<tr class="separator:a2687e4b3cb5da7dbd00e565343f66c6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10a75d5c257fce0d0e521a8f59360759"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a10a75d5c257fce0d0e521a8f59360759"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a10a75d5c257fce0d0e521a8f59360759">v_l</a></td></tr>
<tr class="memdesc:a10a75d5c257fce0d0e521a8f59360759"><td class="mdescLeft">&#160;</td><td class="mdescRight">Velocity for left wheel. <br /></td></tr>
<tr class="separator:a10a75d5c257fce0d0e521a8f59360759"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fb358b515e22053bb9d08df267302ff"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7fb358b515e22053bb9d08df267302ff"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a7fb358b515e22053bb9d08df267302ff">v_r</a></td></tr>
<tr class="memdesc:a7fb358b515e22053bb9d08df267302ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Velocity for right wheel. <br /></td></tr>
<tr class="separator:a7fb358b515e22053bb9d08df267302ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a047da550749cbfda4481133dd1ea99af"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a047da550749cbfda4481133dd1ea99af"></a>
unsigned const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a047da550749cbfda4481133dd1ea99af">nb</a> = 3</td></tr>
<tr class="memdesc:a047da550749cbfda4481133dd1ea99af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of bytes in the message. <br /></td></tr>
<tr class="separator:a047da550749cbfda4481133dd1ea99af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a1049334981cb492eb11e06c60e4fb5"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6a1049334981cb492eb11e06c60e4fb5"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a6a1049334981cb492eb11e06c60e4fb5">Message</a> [<a class="el" href="rollo__comm_8cpp.html#a047da550749cbfda4481133dd1ea99af">nb</a>] = {0x7b, 0x50, 0x10}</td></tr>
<tr class="memdesc:a6a1049334981cb492eb11e06c60e4fb5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Message combined, complete stop default. <br /></td></tr>
<tr class="separator:a6a1049334981cb492eb11e06c60e4fb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2327c485b9ca6502676def4a22819b21"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2327c485b9ca6502676def4a22819b21"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a2327c485b9ca6502676def4a22819b21">MessageEmergencyStop</a> [<a class="el" href="rollo__comm_8cpp.html#a047da550749cbfda4481133dd1ea99af">nb</a>] = {0x7b, 0x50, 0x10}</td></tr>
<tr class="memdesc:a2327c485b9ca6502676def4a22819b21"><td class="mdescLeft">&#160;</td><td class="mdescRight">Emergency message - complete stop. <br /></td></tr>
<tr class="separator:a2327c485b9ca6502676def4a22819b21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a8165a59cdf3528f3915ad5cbc9b20a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1a8165a59cdf3528f3915ad5cbc9b20a"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a1a8165a59cdf3528f3915ad5cbc9b20a">lastMessageTime</a> = 0</td></tr>
<tr class="memdesc:a1a8165a59cdf3528f3915ad5cbc9b20a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Last message from control node. <br /></td></tr>
<tr class="separator:a1a8165a59cdf3528f3915ad5cbc9b20a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a272038ad264893a568c808f13d818b17"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a272038ad264893a568c808f13d818b17"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a272038ad264893a568c808f13d818b17">currentTime</a> = 0</td></tr>
<tr class="memdesc:a272038ad264893a568c808f13d818b17"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current time holder. <br /></td></tr>
<tr class="separator:a272038ad264893a568c808f13d818b17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e0b5a1adcb8ddf86d812edefded9a5c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3e0b5a1adcb8ddf86d812edefded9a5c"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a3e0b5a1adcb8ddf86d812edefded9a5c">EmergencyTime</a> = 3</td></tr>
<tr class="memdesc:a3e0b5a1adcb8ddf86d812edefded9a5c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Emergency time [s]. <br /></td></tr>
<tr class="separator:a3e0b5a1adcb8ddf86d812edefded9a5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1517acc55b2bc4a247d4cb33e8e84a6a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1517acc55b2bc4a247d4cb33e8e84a6a"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a1517acc55b2bc4a247d4cb33e8e84a6a">FlagEmergency</a> = 0</td></tr>
<tr class="memdesc:a1517acc55b2bc4a247d4cb33e8e84a6a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Emergency flag. <br /></td></tr>
<tr class="separator:a1517acc55b2bc4a247d4cb33e8e84a6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4b0142476ae886d68b8a7352da785bf"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab4b0142476ae886d68b8a7352da785bf"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#ab4b0142476ae886d68b8a7352da785bf">Mode</a> [1]</td></tr>
<tr class="memdesc:ab4b0142476ae886d68b8a7352da785bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Message mode description. <br /></td></tr>
<tr class="separator:ab4b0142476ae886d68b8a7352da785bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84e1322ee9513953d58e396cb32b125e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a84e1322ee9513953d58e396cb32b125e"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a84e1322ee9513953d58e396cb32b125e">VelocityL</a></td></tr>
<tr class="memdesc:a84e1322ee9513953d58e396cb32b125e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Message left wheel velocity description. <br /></td></tr>
<tr class="separator:a84e1322ee9513953d58e396cb32b125e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed09ee61ffab38077b4e5852bfcb16e6"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aed09ee61ffab38077b4e5852bfcb16e6"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#aed09ee61ffab38077b4e5852bfcb16e6">VelocityR</a></td></tr>
<tr class="memdesc:aed09ee61ffab38077b4e5852bfcb16e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Message right wheel velocity description. <br /></td></tr>
<tr class="separator:aed09ee61ffab38077b4e5852bfcb16e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a561c6704b01c4755041697214d9c36f0"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a561c6704b01c4755041697214d9c36f0"></a>
unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a561c6704b01c4755041697214d9c36f0">LoopCounter</a> = 1</td></tr>
<tr class="memdesc:a561c6704b01c4755041697214d9c36f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loop counter for debugging purpose. <br /></td></tr>
<tr class="separator:a561c6704b01c4755041697214d9c36f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4dd7cdb763ac065ea299d60fb7a5112c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4dd7cdb763ac065ea299d60fb7a5112c"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a4dd7cdb763ac065ea299d60fb7a5112c">RolloMax</a> = <a class="el" href="rollo_8hpp.html#a114b750e8b7e603ab4e1ec86c17d91ae">ROLLO_SPEED_MAX</a></td></tr>
<tr class="memdesc:a4dd7cdb763ac065ea299d60fb7a5112c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum speed of the Rollo. <br /></td></tr>
<tr class="separator:a4dd7cdb763ac065ea299d60fb7a5112c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a732f8fd84c939ac35086428409dc65ff"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a732f8fd84c939ac35086428409dc65ff"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a732f8fd84c939ac35086428409dc65ff">RolloMin</a> = <a class="el" href="rollo_8hpp.html#aaf870ca6d958bdcc15e02b75044313b2">ROLLO_SPEED_MIN</a></td></tr>
<tr class="memdesc:a732f8fd84c939ac35086428409dc65ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Minimum speed of the Rollo. <br /></td></tr>
<tr class="separator:a732f8fd84c939ac35086428409dc65ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42b5cf6e37e4d7d69b9e07e460ad50df"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a42b5cf6e37e4d7d69b9e07e460ad50df"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rollo__comm_8cpp.html#a42b5cf6e37e4d7d69b9e07e460ad50df">RolloRange</a> = <a class="el" href="rollo__comm_8cpp.html#a4dd7cdb763ac065ea299d60fb7a5112c">RolloMax</a> - <a class="el" href="rollo__comm_8cpp.html#a732f8fd84c939ac35086428409dc65ff">RolloMin</a></td></tr>
<tr class="memdesc:a42b5cf6e37e4d7d69b9e07e460ad50df"><td class="mdescLeft">&#160;</td><td class="mdescRight">Range of speed of the Rollo. <br /></td></tr>
<tr class="separator:a42b5cf6e37e4d7d69b9e07e460ad50df"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Communication between ROS and Rollo. </p>
<dl class="section author"><dt>Author</dt><dd>Rabbia Asghar </dd>
<dd>
Ernest Skrzypczyk</dd></dl>
<dl class="section date"><dt>Date</dt><dd>18/2/16</dd></dl>
<p>Command prototype: <b>rosrun rollo rollo_comm _rate:=10 _ip:=192.168.0.120 _port:=900 _em:=3 _square:=0 _forwardtime:=25 _turntime:=6 _squarespeed:=0.4</b> </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rate</td><td>Command sending frequency of the node &lt;!10 [Hz]&gt; </td></tr>
    <tr><td class="paramname">ip</td><td>Internet protocl address of target robot &lt;!192.168.0.120 [1]&gt; </td></tr>
    <tr><td class="paramname">port</td><td>User datagram protocol taget connection port &lt;!900 [1]&gt; </td></tr>
    <tr><td class="paramname">em</td><td>Emergency time &lt;!3 [s]&gt; </td></tr>
    <tr><td class="paramname">square</td><td>Square test switch &lt;!0 [1]&gt;:<ul>
<li>0 &ndash; Off</li>
<li>1 &ndash; Simple square test</li>
<li>2 &ndash; Double square test</li>
<li>n &ndash; N-th order square test </li>
</ul>
</td></tr>
    <tr><td class="paramname">forwardtime</td><td>Time for forward motion of robot &lt;!25 [s]&gt; </td></tr>
    <tr><td class="paramname">turntime</td><td>Time for turning the robot &lt;!6 [s]&gt; </td></tr>
    <tr><td class="paramname">squarespeed</td><td>Square test forward motion speed &lt;!0.4 [1]&gt;:</td></tr>
  </table>
  </dd>
</dl>
<p>Provides basic communication structure between ROS holding nodes used for localization and Rollo.<br />
Main aspects include:</p><ul>
<li>decode linear and angular velocities provided by control node</li>
<li>translate and send message to Rollo</li>
<li>publish decoded velocities</li>
<li>square test or n-th order</li>
<li>emergency procedure</li>
</ul>
<p>Project github repository</p>
<dl class="section see"><dt>See also</dt><dd><a href="https://github.com/em-er-es/rollo/">https://github.com/em-er-es/rollo/</a> </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ae08ba04eb54f1f3f17f135034452e92c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int decodeVelocities </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>VelocityL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>VelocityR</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Decode linear and angular velocities. </p>
<p>Velocities are decoded and stored as partial bytes of the UDP packet</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">x</td><td>Linear velocity </td></tr>
    <tr><td class="paramname">z</td><td>Angular veolocity </td></tr>
    <tr><td class="paramname">&amp;Message</td><td>UDP message to be send to target robot </td></tr>
    <tr><td class="paramname">VelocityL</td><td>Decoded velocity [%] </td></tr>
    <tr><td class="paramname">VelocityR</td><td>Decoded velocity [%]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 </dd></dl>
<p>Determine corresponding operation mode based on velocities</p>
<p>Since control node can provide abstract control values, an ideal case could be used for decoding velocities. This is discouraged, since using alternative control methods would probably have a realistic value set.<br />
</p>
<p>Linear velocity is approximately 0:</p>
<ul>
<li>Complete stop</li>
<li>Right rotation</li>
<li>Left rotation</li>
<li>Lowest speeds for previous modes</li>
</ul>
<p>Linear velocity is above tolerance threshold</p>
<p>Determine speeds based on the position of the "dial" z:<br />
</p><pre>
   |-a-|- - -*-b- - - - -|
  -1   z     0           1
</pre><p>Temporary velocity holder declaration</p>
<p>Eliminate problems with dividing through zero by adding a small number to variables</p>
<p>Calculate velocities according to relation expressed in linear and angular velocities ratio</p>
<p>Translate velocities for Rollo:</p><ul>
<li>Left wheel velocity - Second byte</li>
<li>Right wheel velocity - Third byte<ul>
<li>Temporary fix for errartic behaviour of Rollo</li>
</ul>
</li>
</ul>
<p>Determine forward or backward movement based on linear velocity </p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="rollo__comm_8cpp_ae08ba04eb54f1f3f17f135034452e92c_icgraph.svg" width="412" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</p>

</div>
</div>
<a class="anchor" id="af756e338ef4741c56e65779cad33d03d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EstimateFeedbackVelocities </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>VelocityL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>VelocityR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double &amp;&#160;</td>
          <td class="paramname"><em>LeftVelocityEstimate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double &amp;&#160;</td>
          <td class="paramname"><em>RightVelocityEstimate</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Assign left and right wheel velocity estimates for a given velocity command. </p>
<p>System odometry simulation in absence of encoder feedback using estimates from processed and analyzed data</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">LeftVelocityEstimate</td><td>Estimated velocity for left wheel determined from logs [rad/s] </td></tr>
    <tr><td class="paramname">RightVelocityEstimate</td><td>Estimated velocity for right wheel determined from logs [rad/s] </td></tr>
    <tr><td class="paramname">VelocityL</td><td>Velocity command decoded from control node [%] </td></tr>
    <tr><td class="paramname">VelocityR</td><td>Velocity command decoded from control node [%]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Warning</dt><dd>Only velocities processed using logs are estimated.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>0 </dd></dl>
<ul>
<li>No movement</li>
<li>Slowest movement speed &ndash; 6%</li>
<li>Slow movement speed &ndash; 12%</li>
<li>Lower medium movement speed &ndash; 19%</li>
<li>Fastest movement speed in current configuration &ndash; 56%</li>
<li>Combination of different movement speeds &ndash; L12% &amp; R19%</li>
<li>Combination of different movement speeds &ndash; L19% &amp; R12%</li>
<li>Combination of different movement speeds &ndash; L31% &amp; R38%</li>
<li>Combination of different movement speeds &ndash; L38% &amp; R31% </li>
</ul>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="rollo__comm_8cpp_af756e338ef4741c56e65779cad33d03d_icgraph.svg" width="298" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Node main. </p>
<p>Depending on specified parameters processes data from control node and Rollo and transmits them to appropriate targets or runs a square test of n-th order</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rate</td><td>Command sending frequency of the node &lt;!10 [Hz]&gt; </td></tr>
    <tr><td class="paramname">ip</td><td>Internet protocl address of target robot &lt;!192.168.0.120 [1]&gt; </td></tr>
    <tr><td class="paramname">port</td><td>User datagram protocol taget connection port &lt;!900 [1]&gt; </td></tr>
    <tr><td class="paramname">em</td><td>Emergency time &lt;!3 [s]&gt; </td></tr>
    <tr><td class="paramname">square</td><td>Square test switch &lt;!0 [1]&gt;:<ul>
<li>0 &ndash; Off</li>
<li>1 &ndash; Simple square test</li>
<li>2 &ndash; Double square test</li>
<li>n &ndash; N-th order square test </li>
</ul>
</td></tr>
    <tr><td class="paramname">forwardtime</td><td>Time for forward motion of robot &lt;!25 [s]&gt; </td></tr>
    <tr><td class="paramname">turntime</td><td>Time for turning the robot &lt;!6 [s]&gt; </td></tr>
    <tr><td class="paramname">squarespeed</td><td>Square test forward motion speed &lt;!0.4 [1]&gt;:</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 </dd></dl>
<h2>Initalization</h2>
<p>Initialize node</p>
<p>Initialize nodehandle</p>
<p>Initialie subscriber and define topic and message queue size</p>
<p>Publish velocities as [rpm]</p>
<p>Initialize node arguments using command line</p>
<p>Initialize node parameters from launch file or command line. Use a private node handle so that multiple instances of the node can be run simultaneously while using different parameters.</p>
<p>Node main parameters</p>
<p>Emergency parameters</p>
<p>Square test parameters Default values</p>
<p>Feedback velocities in rad/s to publish</p>
<p>Node frequency rate [Hz]</p>
<p>Initialize subscriber message type</p>
<p>Initialize publisher message type</p>
<p>Initialize variables for computing linear and angular velocity of the robot</p>
<p>Client initialization</p>
<h2>Square test</h2>
<p>Alternatively this square test could be in control node, however communication node is "closer" to Rollo</p>
<ul>
<li>Print information on current run</li>
<li>Compose turn command</li>
<li>Check square run variable and determine turning direction</li>
</ul>
<p>For multiple runs the robot would go back and forth providing more reliable data on the actual error In ideal case even a high order square run would result in the robot being at the initial position with initial orientation</p>
<ul>
<li>Compose forward command</li>
<li>Set initial time</li>
<li>Initialize bytes sent variable for debugging</li>
<li>Print square test parameters</li>
</ul>
<h3>Main square loop</h3>
<ol type="1">
<li>Moving forward<ul>
<li>Send command 3 times</li>
<li>Wait for the specified time to move forward</li>
</ul>
</li>
<li>Turning<ul>
<li>Send command 3 times</li>
<li>Wait for the specified time to turn</li>
</ul>
</li>
</ol>
<h3>Main square loop end</h3>
<ul>
<li>Update run finish time</li>
<li>Print duration time</li>
<li>Check square loop condition<ul>
<li>Turn around<ul>
<li>Send command 3 times</li>
<li>Wait for twice the specified time to turn around</li>
</ul>
</li>
<li>Update square run counter and check for exit condition</li>
</ul>
</li>
<li>Stop<ul>
<li>Send stop command 10 times</li>
</ul>
</li>
<li>Update square run counter and check for exit condition</li>
<li>Use LoopCounter as square test run indicator</li>
</ul>
<h2>Square test end</h2>
<h2>Main loop</h2>
<ul>
<li>Send control command to Rollo</li>
</ul>
<h3>Emergency procedure</h3>
<ul>
<li>Check if emergency condition has been met:</li>
<li>Print emergency message</li>
<li>Conduct emergency stop</li>
</ul>
<p>Send emergency message 10 times</p>
<ul>
<li>Hard condition emergency procedure<br />
Exit with an error code if hard condition is set by using negative values for emergency time</li>
<li>Soft condition emergency procedure<ul>
<li>Set emergency flag</li>
<li>Empty procedure sequence if emergency flag is raised<ul>
<li>ROS spinOnce</li>
<li>Sleep before running loop again</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Emergency procedure end</h3>
<ul>
<li>Estimate feedback velocities</li>
<li>Compose message to be published:<ul>
<li>Assign timestamp</li>
<li>Assign estimated feedback velocities</li>
</ul>
</li>
<li>Publish message</li>
<li>Print published message</li>
</ul>
<p>ROS spinOnce</p>
<p>Sleep before running loop again</p>
<p>Increase LoopCounter</p>
<h2>Main loop end</h2>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="rollo__comm_8cpp_a3c04138a5bfe5d72780bb7e82a18e627_cgraph.svg" width="478" height="190"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</p>

</div>
</div>
<a class="anchor" id="aed7376fac78c6c864f69338bd09e3133"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void subscriberCallback </td>
          <td>(</td>
          <td class="paramtype">const geometry_msgs::Twist::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subscriber callback from control node. </p>
<p>Read newest velocities from control node and translate them into UDP message. Update latest message time.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>Message from control node containing linear and angular velocities</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 </dd></dl>
<p>Update the UDP message</p>
<p>Update last message time</p>
<p>Reset emergency flag </p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="rollo__comm_8cpp_aed7376fac78c6c864f69338bd09e3133_cgraph.svg" width="314" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="rollo__comm_8cpp_aed7376fac78c6c864f69338bd09e3133_icgraph.svg" width="243" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</p>

</div>
</div>
<a class="anchor" id="a46c0664a525ae3467335e8ba78396d07"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int udpSend </td>
          <td>(</td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>ip</em>[16], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Message</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send UDP packets. </p>
<p>Send provided message using included UDP library command <code><a class="el" href="classudp__client__server_1_1udp__client.html#ac296d1fb6a6006bec5f8f14a81367d0a" title="Send a message through this UDP client. ">udp_client_server::udp_client.send()</a></code> </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">&amp;ip</td><td>IP address of the target robot </td></tr>
    <tr><td class="paramname">&amp;port</td><td>UDP port of the target robot </td></tr>
    <tr><td class="paramname">&amp;message</td><td>UDP message sent to robot</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Bytes sent </dd></dl>
<p>Client initialization</p>
<p>Send UDP message</p>
<p>Check if number of bytes sent is equal to bytes of composed message</p>
<p>Error handling</p>
<p>Return bytes sent or error code </p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="rollo__comm_8cpp_a46c0664a525ae3467335e8ba78396d07_cgraph.svg" width="264" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="rollo__comm_8cpp_a46c0664a525ae3467335e8ba78396d07_icgraph.svg" width="183" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
